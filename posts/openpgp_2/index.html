<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>À la recherche du workflow GPG parfait (Partie 2) | Polyedre</title><meta name=keywords content><meta name=description content="Dans la partie précédente, j&rsquo;ai créé une paire de clé GPG primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé primaire sur un support physique déconnecté d&rsquo;internet et transférer les clés secondaires sur le trousseau système.
En cas de maintenance sur les clés secondaires, comme une extension de leur durée de validité ou encore leur renouvellement, il sera nécessaire d&rsquo;utiliser la clé principale, et nous allons voir comment le faire."><meta name=author content="Polyedre"><link rel=canonical href=https://polyedre.github.io/posts/openpgp_2/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=/profile.jpeg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://polyedre.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://polyedre.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://polyedre.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://polyedre.github.io/apple-touch-icon.png><link rel=mask-icon href=https://polyedre.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.119.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PL8DXXK8VN"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PL8DXXK8VN",{anonymize_ip:!1})}</script><meta property="og:title" content="À la recherche du workflow GPG parfait (Partie 2)"><meta property="og:description" content="Dans la partie précédente, j&rsquo;ai créé une paire de clé GPG primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé primaire sur un support physique déconnecté d&rsquo;internet et transférer les clés secondaires sur le trousseau système.
En cas de maintenance sur les clés secondaires, comme une extension de leur durée de validité ou encore leur renouvellement, il sera nécessaire d&rsquo;utiliser la clé principale, et nous allons voir comment le faire."><meta property="og:type" content="article"><meta property="og:url" content="https://polyedre.github.io/posts/openpgp_2/"><meta property="og:image" content="https://polyedre.github.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-29T00:00:00+01:00"><meta property="article:modified_time" content="2022-04-29T00:00:00+01:00"><meta property="og:site_name" content="Polyedre"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://polyedre.github.io/"><meta name=twitter:title content="À la recherche du workflow GPG parfait (Partie 2)"><meta name=twitter:description content="Dans la partie précédente, j&rsquo;ai créé une paire de clé GPG primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé primaire sur un support physique déconnecté d&rsquo;internet et transférer les clés secondaires sur le trousseau système.
En cas de maintenance sur les clés secondaires, comme une extension de leur durée de validité ou encore leur renouvellement, il sera nécessaire d&rsquo;utiliser la clé principale, et nous allons voir comment le faire."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://polyedre.github.io/posts/"},{"@type":"ListItem","position":2,"name":"À la recherche du workflow GPG parfait (Partie 2)","item":"https://polyedre.github.io/posts/openpgp_2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"À la recherche du workflow GPG parfait (Partie 2)","name":"À la recherche du workflow GPG parfait (Partie 2)","description":"Dans la partie précédente, j\u0026rsquo;ai créé une paire de clé GPG primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé primaire sur un support physique déconnecté d\u0026rsquo;internet et transférer les clés secondaires sur le trousseau système.\nEn cas de maintenance sur les clés secondaires, comme une extension de leur durée de validité ou encore leur renouvellement, il sera nécessaire d\u0026rsquo;utiliser la clé principale, et nous allons voir comment le faire.","keywords":[],"articleBody":"Dans la partie précédente, j’ai créé une paire de clé GPG primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé primaire sur un support physique déconnecté d’internet et transférer les clés secondaires sur le trousseau système.\nEn cas de maintenance sur les clés secondaires, comme une extension de leur durée de validité ou encore leur renouvellement, il sera nécessaire d’utiliser la clé principale, et nous allons voir comment le faire.\nChoix du support Plusieurs supports sont disponibles pour sauvegarder la clé primaire. Plusieurs facteurs sont à prendre en compte. Ils peuvent être organisés sous le spectre de l’acronyme CIA, pour Confidentiality, Integrity, et Availability (Confidentialité, Intégrité et Disponibilité pour les non-bilingues) :\nConcernant la confidentialité, il est évident que je ne souhaite pas qu’une personne malintentionnée puisse facilement accéder cette clé. Dans mon modèle de sécurité, je considère irréaliste le fait qu’une personne entre par effraction chez moi pour voler cette clé. Je vais donc la sauvegarder chez moi dans un format non-chiffré mais nécessitant tout de même le mot de passe de la clé pour l’utiliser.\nConcernant la disponibilité, je veux pouvoir accéder à la clé pendant au moins 2 ans, puisque c’est la durée pendant laquelle elle a été configurée pour être valide (voir la partie précédente). Le fichier doit être accessible depuis chez moi et je ne pense pas qu’il soit nécessaire d’y accéder depuis un autre endroit.\nL’intégrité de la clé est assurée par le fait que la clé publique est accessible indépendamment de la clé et qu’il est possible de vérifier facilement si la clé publique correspond à la clé privée.\nOn va être honnête, c’est beaucoup de blabla juste pour annoncer que par soucis de simplicité, la clé primaire va être sauvegardée sur une clé USB. Pour le fun, je vais aussi la sauvegarder sur un format papier, mais ça sera peut-être pour une autre fois.\nSauvegarde de la clé primaire, transfert des clés secondaires Pour sauvegarder la clé primaire, rien de plus simple. La commande suivante permet d’exporter la clé privée dans un fichier :\ngpg --armor --export-secret-keys \"polyedre@disroot.org\" \u003e polyedre.key Il suffit ensuite de placer ce fichier sur une clé USB.\nSauvegardons également les clés secondaires dans leur fichier.\ngpg --armor --export-secret-subkeys \"polyedre@disroot.org\" \u003e polyedre.subkeys Je peut maintenant importer ces clés dans le trousseau par défaut du système. Rappelons-nous, dans la partie 1, la clé PGP a été générée dans un trousseau temporaire.\nunset GNUPGHOME gpg --import polyedre.subkeys Et voilà !\nMes clés sont importées et disponibles :\npolyedre@machine $ gpg --list-secret-keys /home/polyedre/.gnupg/pubring.kbx ------------------------------ sec# rsa4096 2022-04-30 [C] [expires: 2024-04-29] 054350865F0474F5D2497D69913174CACD67AE0F uid [ unknown] Polyedre ssb rsa4096 2022-04-30 [S] [expires: 2023-04-30] ssb rsa4096 2022-04-30 [E] [expires: 2023-04-30] ssb rsa4096 2022-04-30 [A] [expires: 2023-04-30] On remarquera la présence du croisillon (#) indiquant que la clé privée principale n’est pas présente dans le trousseau.\nUtiliser la clé primaire Les 3 clés secondaires peuvent maintenant être utilisées normalement. Comme promis, voyons comment utiliser la clé primaire pour modifier les clés secondaires.\nJe ne veux pas que ma clé primaire soit dans le trousseau su système, donc comme pour la partie 1, je vais créer un trousseau temporaire.\nexport GNUPGHOME=$(mktemp -d) J’y importe la clé primaire sauvegardée sur la clé USB.\ngpg --import polyedre.key Automatiquement, les clés secondaires sont disponibles :\npolyedre@machine $ gpg --list-secret-keys /tmp/tmp.7pQf2b7qXY/pubring.kbx ------------------------------- sec rsa4096 2022-04-30 [C] [expires: 2024-04-29] 054350865F0474F5D2497D69913174CACD67AE0F uid [ unknown] Polyedre ssb rsa4096 2022-04-30 [S] [expires: 2023-04-30] ssb rsa4096 2022-04-30 [E] [expires: 2023-04-30] ssb rsa4096 2022-04-30 [A] [expires: 2023-04-30] Je peux ensuite augmenter la durée de validité d’une des clés secondaires :\npolyedre@machine $ gpg --edit-key polyedre@disroot.org Secret key is available. sec rsa4096/913174CACD67AE0F created: 2022-04-30 expires: 2024-04-29 usage: C trust: unknown validity: unknown ssb rsa4096/505199DE46ABA45C created: 2022-04-30 expires: 2023-04-30 usage: S ssb rsa4096/8CDCD83070A02AFB created: 2022-04-30 expires: 2023-04-30 usage: E ssb rsa4096/41C03C2FDB86A1EC created: 2022-04-30 expires: 2023-04-30 usage: A [ unknown] (1). Polyedre gpg\u003e key 1 sec rsa4096/913174CACD67AE0F created: 2022-04-30 expires: 2024-04-29 usage: C trust: unknown validity: unknown ssb* rsa4096/505199DE46ABA45C created: 2022-04-30 expires: 2023-04-30 usage: S ssb rsa4096/8CDCD83070A02AFB created: 2022-04-30 expires: 2023-04-30 usage: E ssb rsa4096/41C03C2FDB86A1EC created: 2022-04-30 expires: 2023-04-30 usage: A [ unknown] (1). Polyedre gpg\u003e expire Changing expiration time for a subkey. Please specify how long the key should be valid. 0 = key does not expire = key expires in n days w = key expires in n weeks m = key expires in n months y = key expires in n years Key is valid for? (0) 1w Key expires at sam. 07 mai 2022 21:32:06 CEST Is this correct? (y/N) y sec rsa4096/913174CACD67AE0F created: 2022-04-30 expires: 2024-04-29 usage: C trust: unknown validity: unknown ssb* rsa4096/505199DE46ABA45C created: 2022-04-30 expires: 2022-05-07 usage: S ssb rsa4096/8CDCD83070A02AFB created: 2022-04-30 expires: 2023-04-30 usage: E ssb rsa4096/41C03C2FDB86A1EC created: 2022-04-30 expires: 2023-04-30 usage: A [ unknown] (1). Polyedre gpg\u003e save polyedre@machine $ gpg -K gpg: checking the trustdb gpg: no ultimately trusted keys found /tmp/tmp.7pQf2b7qXY/pubring.kbx ------------------------------- sec rsa4096 2022-04-30 [C] [expires: 2024-04-29] 054350865F0474F5D2497D69913174CACD67AE0F uid [ unknown] Polyedre ssb rsa4096 2022-04-30 [S] [expires: 2022-05-07] ssb rsa4096 2022-04-30 [E] [expires: 2023-04-30] ssb rsa4096 2022-04-30 [A] [expires: 2023-04-30] Pour valider le changement, il suffit d’exporter à nouveau les clés secondaire et de les importer dans le trousseau du système.\nconclusion Et voilà, il reste une toute dernière étape : publier la clé publique sur un serveur de clé.\npolyedre@machine $ gpg --send-keys 054350865F0474F5D2497D69913174CACD67AE0F gpg: sending key 913174CACD67AE0F to hkps://keys.openpgp.org L’identifiant de la clé peut être obtenu en listant les clés privées. Dans mon cas, l’auto-complétion de la commande m’a permis de selectionner la clé à publier.\n","wordCount":"941","inLanguage":"en","datePublished":"2022-04-29T00:00:00+01:00","dateModified":"2022-04-29T00:00:00+01:00","author":{"@type":"Person","name":"Polyedre"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://polyedre.github.io/posts/openpgp_2/"},"publisher":{"@type":"Organization","name":"Polyedre","logo":{"@type":"ImageObject","url":"https://polyedre.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://polyedre.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://polyedre.github.io/profile.jpeg alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://polyedre.github.io/posts/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://polyedre.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://polyedre.github.io/posts/>Posts</a></div><h1 class=post-title>À la recherche du workflow GPG parfait (Partie 2)</h1><div class=post-meta><span title='2022-04-29 00:00:00 +0100 +0100'>April 29, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Polyedre&nbsp;|&nbsp;<a href=https://github.com/polyedre/polyedre.github.io/content/posts/openpgp_2.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Dans la <a href=openpgp_1.md>partie précédente</a>, j&rsquo;ai créé une paire de clé GPG
primaire sur un trousseau temporaire, puis 3 clés secondaires pour chaque
usage : signer, chiffrer et authentifier. Je peux maintenant sauvegarder la clé
primaire sur un support physique déconnecté d&rsquo;internet et transférer les clés
secondaires sur le trousseau système.</p><p>En cas de maintenance sur les clés secondaires, comme une extension de leur
durée de validité ou encore leur renouvellement, il sera nécessaire d&rsquo;utiliser
la clé principale, et nous allons voir comment le faire.</p><h2 id=choix-du-support>Choix du support<a hidden class=anchor aria-hidden=true href=#choix-du-support>#</a></h2><p>Plusieurs supports sont disponibles pour sauvegarder la clé primaire. Plusieurs
facteurs sont à prendre en compte. Ils peuvent être organisés sous le spectre de
l&rsquo;acronyme CIA, pour Confidentiality, Integrity, et Availability
(Confidentialité, Intégrité et Disponibilité pour les non-bilingues) :</p><ul><li><p>Concernant la confidentialité, il est évident que je ne souhaite pas qu&rsquo;une
personne malintentionnée puisse facilement accéder cette clé. Dans mon modèle
de sécurité, je considère irréaliste le fait qu&rsquo;une personne entre par
effraction chez moi pour voler cette clé. Je vais donc la sauvegarder chez moi
dans un format non-chiffré mais nécessitant tout de même le mot de passe de la
clé pour l&rsquo;utiliser.</p></li><li><p>Concernant la disponibilité, je veux pouvoir accéder à la clé pendant au moins
2 ans, puisque c&rsquo;est la durée pendant laquelle elle a été configurée pour être
valide (voir la partie précédente). Le fichier doit être accessible depuis
chez moi et je ne pense pas qu&rsquo;il soit nécessaire d&rsquo;y accéder depuis un autre
endroit.</p></li><li><p>L&rsquo;intégrité de la clé est assurée par le fait que la clé publique est
accessible indépendamment de la clé et qu&rsquo;il est possible de vérifier
facilement si la clé publique correspond à la clé privée.</p></li></ul><p>On va être honnête, c&rsquo;est beaucoup de blabla juste pour annoncer que par soucis
de simplicité, la clé primaire va être sauvegardée sur une clé USB. Pour le fun,
je vais aussi la sauvegarder sur un format papier, mais ça sera peut-être pour
une autre fois.</p><h2 id=sauvegarde-de-la-clé-primaire-transfert-des-clés-secondaires>Sauvegarde de la clé primaire, transfert des clés secondaires<a hidden class=anchor aria-hidden=true href=#sauvegarde-de-la-clé-primaire-transfert-des-clés-secondaires>#</a></h2><p>Pour sauvegarder la clé primaire, rien de plus simple. La commande suivante
permet d&rsquo;exporter la clé privée dans un fichier :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gpg --armor --export-secret-keys <span style=color:#e6db74>&#34;polyedre@disroot.org&#34;</span> &gt; polyedre.key
</span></span></code></pre></div><p>Il suffit ensuite de placer ce fichier sur une clé USB.</p><p>Sauvegardons également les clés secondaires dans leur fichier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gpg --armor --export-secret-subkeys <span style=color:#e6db74>&#34;polyedre@disroot.org&#34;</span> &gt; polyedre.subkeys
</span></span></code></pre></div><p>Je peut maintenant importer ces clés dans le trousseau par défaut du système.
Rappelons-nous, dans la partie 1, la clé PGP a été générée dans un trousseau
temporaire.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>unset GNUPGHOME
</span></span><span style=display:flex><span>gpg --import polyedre.subkeys
</span></span></code></pre></div><p>Et voilà !</p><p>Mes clés sont importées et disponibles :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>polyedre@machine $ gpg --list-secret-keys
</span></span><span style=display:flex><span>/home/polyedre/.gnupg/pubring.kbx
</span></span><span style=display:flex><span>------------------------------
</span></span><span style=display:flex><span>sec#  rsa4096 2022-04-30 <span style=color:#f92672>[</span>C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2024-04-29<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      054350865F0474F5D2497D69913174CACD67AE0F
</span></span><span style=display:flex><span>uid           <span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>S<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>E<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>A<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>On remarquera la présence du croisillon (<code>#</code>) indiquant que la clé privée
principale n&rsquo;est pas présente dans le trousseau.</p><h2 id=utiliser-la-clé-primaire>Utiliser la clé primaire<a hidden class=anchor aria-hidden=true href=#utiliser-la-clé-primaire>#</a></h2><p>Les 3 clés secondaires peuvent maintenant être utilisées normalement. Comme
promis, voyons comment utiliser la clé primaire pour modifier les clés
secondaires.</p><p>Je ne veux pas que ma clé primaire soit dans le trousseau su système, donc comme
pour la partie 1, je vais créer un trousseau temporaire.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export GNUPGHOME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>mktemp -d<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>J&rsquo;y importe la clé primaire sauvegardée sur la clé USB.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gpg --import polyedre.key
</span></span></code></pre></div><p>Automatiquement, les clés secondaires sont disponibles :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>polyedre@machine $ gpg --list-secret-keys
</span></span><span style=display:flex><span>/tmp/tmp.7pQf2b7qXY/pubring.kbx
</span></span><span style=display:flex><span>-------------------------------
</span></span><span style=display:flex><span>sec   rsa4096 2022-04-30 <span style=color:#f92672>[</span>C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2024-04-29<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      054350865F0474F5D2497D69913174CACD67AE0F
</span></span><span style=display:flex><span>uid           <span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>S<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>E<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>A<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Je peux ensuite augmenter la durée de validité d&rsquo;une des clés secondaires :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>polyedre@machine $ gpg --edit-key polyedre@disroot.org
</span></span><span style=display:flex><span>Secret key is available.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sec  rsa4096/913174CACD67AE0F
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2024-04-29  usage: C
</span></span><span style=display:flex><span>     trust: unknown       validity: unknown
</span></span><span style=display:flex><span>ssb  rsa4096/505199DE46ABA45C
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: S
</span></span><span style=display:flex><span>ssb  rsa4096/8CDCD83070A02AFB
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: E
</span></span><span style=display:flex><span>ssb  rsa4096/41C03C2FDB86A1EC
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: A
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>. Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; key <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sec  rsa4096/913174CACD67AE0F
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2024-04-29  usage: C
</span></span><span style=display:flex><span>     trust: unknown       validity: unknown
</span></span><span style=display:flex><span>ssb* rsa4096/505199DE46ABA45C
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: S
</span></span><span style=display:flex><span>ssb  rsa4096/8CDCD83070A02AFB
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: E
</span></span><span style=display:flex><span>ssb  rsa4096/41C03C2FDB86A1EC
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: A
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>. Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; expire
</span></span><span style=display:flex><span>Changing expiration time <span style=color:#66d9ef>for</span> a subkey.
</span></span><span style=display:flex><span>Please specify how long the key should be valid.
</span></span><span style=display:flex><span>         0 <span style=color:#f92672>=</span> key does not expire
</span></span><span style=display:flex><span>      &lt;n&gt;  <span style=color:#f92672>=</span> key expires in n days
</span></span><span style=display:flex><span>      &lt;n&gt;w <span style=color:#f92672>=</span> key expires in n weeks
</span></span><span style=display:flex><span>      &lt;n&gt;m <span style=color:#f92672>=</span> key expires in n months
</span></span><span style=display:flex><span>      &lt;n&gt;y <span style=color:#f92672>=</span> key expires in n years
</span></span><span style=display:flex><span>Key is valid <span style=color:#66d9ef>for</span>? <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> 1w
</span></span><span style=display:flex><span>Key expires at sam. <span style=color:#ae81ff>07</span> mai <span style=color:#ae81ff>2022</span> 21:32:06 CEST
</span></span><span style=display:flex><span>Is this correct? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sec  rsa4096/913174CACD67AE0F
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2024-04-29  usage: C
</span></span><span style=display:flex><span>     trust: unknown       validity: unknown
</span></span><span style=display:flex><span>ssb* rsa4096/505199DE46ABA45C
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2022-05-07  usage: S
</span></span><span style=display:flex><span>ssb  rsa4096/8CDCD83070A02AFB
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: E
</span></span><span style=display:flex><span>ssb  rsa4096/41C03C2FDB86A1EC
</span></span><span style=display:flex><span>     created: 2022-04-30  expires: 2023-04-30  usage: A
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>. Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; save
</span></span><span style=display:flex><span>polyedre@machine $ gpg -K
</span></span><span style=display:flex><span>gpg: checking the trustdb
</span></span><span style=display:flex><span>gpg: no ultimately trusted keys found
</span></span><span style=display:flex><span>/tmp/tmp.7pQf2b7qXY/pubring.kbx
</span></span><span style=display:flex><span>-------------------------------
</span></span><span style=display:flex><span>sec   rsa4096 2022-04-30 <span style=color:#f92672>[</span>C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2024-04-29<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      054350865F0474F5D2497D69913174CACD67AE0F
</span></span><span style=display:flex><span>uid           <span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> Polyedre &lt;polyedre@disroot.org&gt;
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>S<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2022-05-07<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>E<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ssb   rsa4096 2022-04-30 <span style=color:#f92672>[</span>A<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2023-04-30<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Pour valider le changement, il suffit d&rsquo;exporter à nouveau les clés secondaire
et de les importer dans le trousseau du système.</p><h2 id=conclusion>conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Et voilà, il reste une toute dernière étape : publier la clé publique sur un
serveur de clé.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>polyedre@machine $ gpg --send-keys 054350865F0474F5D2497D69913174CACD67AE0F
</span></span><span style=display:flex><span>gpg: sending key 913174CACD67AE0F to hkps://keys.openpgp.org
</span></span></code></pre></div><p>L&rsquo;identifiant de la clé peut être obtenu en listant les clés privées. Dans mon
cas, l&rsquo;auto-complétion de la commande m&rsquo;a permis de selectionner la clé à
publier.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://polyedre.github.io/posts/dive/><span class=title>« Prev Page</span><br><span>Identifying unused files in Docker images with Dive</span></a>
<a class=next href=https://polyedre.github.io/posts/openpgp_1/><span class=title>Next Page »</span><br><span>À la recherche du workflow GPG parfait (Partie 1)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://polyedre.github.io/>Polyedre</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>